#This file can be used to build binder using preinstalled LLVM/Clang
CMAKE_MINIMUM_REQUIRED(VERSION 3.4.3)
PROJECT(binder CXX C)
SET(VERSION 1.0.0)
#This actually will work even with C++11
set(CMAKE_CXX_STANDARD 14)
set(CMAKE_VERBOSE_MAKEFILE ON)
set(LLVM_REQUIRES_EH ON)
include("GNUInstallDirs")
set(LLVM_DIR_ORIG ${LLVM_DIR})
set(Clang_DIR_ORIG ${Clang_DIR})
find_package(Clang QUIET)
find_package(LLVM  QUIET)
if (Clang AND LLVM )
MESSAGE(STATUS  "binder:  cmake configurations  llvm and clang were found.")
SET(CMAKE_MODULE_PATH "${CMAKE_MODULE_PATH};${LLVM_CMAKE_DIR}")
include_directories( ${CLANG_INCLUDE_DIRS} ${LibClang_INCLUDE_DIRS})
include(AddLLVM)
else()
MESSAGE(STATUS  "binder: llvm or clang cmake configurations were not found. Trying another approach.")
set(LLVM_DIR ${LLVM_DIR_ORIG})
set(Clang_DIR ${Clang_DIR_ORIG})
MESSAGE(STATUS  "binder: LLVM_DIR=${LLVM_DIR}")
MESSAGE(STATUS  "binder: Clang_DIR=${Clang_DIR}")
find_program(LLVMCONFIG NAMES llvm-config HINTS  ${LLVMCONFIG} ${LLVM_DIR}/bin ${PATH} /usr/bin/ /usr/local/bin)
if (LLVMCONFIG)
MESSAGE(STATUS  "binder: llvm-config found in ${LLVMCONFIG}")
execute_process (COMMAND ${LLVMCONFIG}  --version       OUTPUT_VARIABLE  LLVMVERSION OUTPUT_STRIP_TRAILING_WHITESPACE)
execute_process (COMMAND ${LLVMCONFIG}  --libdir          OUTPUT_VARIABLE  LLVMLIBDIR OUTPUT_STRIP_TRAILING_WHITESPACE)
execute_process (COMMAND ${LLVMCONFIG}  --includedir  OUTPUT_VARIABLE  LLVMINCLUDEDIR OUTPUT_STRIP_TRAILING_WHITESPACE)
include_directories( ${LLVMINCLUDEDIR})
include_directories( ${CLANG_INCLUDE_DIRS} )
link_directories(${LLVMLIBDIR} )
string(REPLACE "." ";" VERSION_LIST ${LLVMVERSION})
list(GET VERSION_LIST 0 LLVM_VERSION_MAJOR)
list(GET VERSION_LIST 1 LLVM_VERSION_MINOR)
list(GET VERSION_LIST 2 LLVM_VERSION_PATCH)
MESSAGE(STATUS  "binder: llvm version is ${LLVMVERSION}")
MESSAGE(STATUS  "binder: LLVM_VERSION_MAJOR=${LLVM_VERSION_MAJOR}")
MESSAGE(STATUS  "binder: LLVM_VERSION_MINOR=${LLVM_VERSION_MINOR}")
else()
MESSAGE(ERROR  "binder: llvm-config not found")
endif()
endif()

macro(add_clang_executable name)
  add_executable( ${name} ${ARGN} )
  set_target_properties(${name} PROPERTIES FOLDER "Clang executables")
endmacro(add_clang_executable)
include_directories(source)
add_subdirectory(source)
